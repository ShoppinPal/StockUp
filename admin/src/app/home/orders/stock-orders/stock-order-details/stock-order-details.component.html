<ngx-loading [show]="loading"></ngx-loading>
<div class="animated fadeIn">
  <div class="row">
    <div class="col-sm-12">
      <div class="card">
        <div class="card-header">
          <strong>Stock order details</strong>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="form-group col-sm-6">
              <p>Name: <strong>{{order.name}}</strong></p>
              <p>Total Items: <strong>{{totalApprovedLineItems+totalNotApprovedLineItems}}</strong></p>
              <p>Created At: <strong>{{order.created}}</strong></p>
            </div>
            <!--<div class="form-group col-sm-12">-->
            <!--<div class="input-group">-->
            <!--<span>(Upload Min Display Quantities and Shelf Capacities) &nbsp;&nbsp; </span>-->
            <!--<input type="file" ng2FileSelect [uploader]="uploader"/>-->
            <!--</div>-->
            <!--</div>-->
          </div>
        </div>
        <div class="card-footer">
          <div class="row">
            <div class="col-sm-3">
              <span class="input-group-btn">
                <button class="btn btn-primary" type="button" (click)="updateLineItems([], {approved: true})">Approve all</button>
              </span>
            </div>
            <div class="col-sm-3">
              <span class="input-group-btn">
                <button class="btn btn-success" type="button"
                        (click)="createTransferOrder()">Create Transfer Order</button>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div><!--/.col-->
  </div><!--/.row-->

  <div class="row">
    <div class="col-sm-12">
      <div class="card">
        <div class="card-header">
          <strong>Search products</strong>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-sm-12">
              <div class="form-group">
                <div class="input-group">
                  <input type="text"
                         class="form-control"
                         id="searchSKU"
                         [(ngModel)]="searchSKUText"
                         placeholder="Scan SKU barcode here or enter text">
                  <span class="input-group-btn">
                    <button class="btn btn-primary" type="button"
                            (click)="searchProductBySku(searchSKUText)">
                      <i class="fa fa-search"></i> Search
                    </button>
                  </span>
                </div>
              </div>
            </div>
          </div><!--/.row-->
        </div>
        <div class="card-footer">
          <div class="row">
            <div class="col-sm-6">
              <button type="button" class="btn btn-link" (click)="searchSKUText='';getNotApprovedStockOrderLineItems();getApprovedStockOrderLineItems()">
                Clear All Searches
              </button>
            </div>
          </div>
        </div>
      </div>
    </div><!--/.col-->
  </div><!--/.row-->

  <div class="row">
    <div class="col-lg-12">
      <div class="card">
        <div class="card-header">
          <i class="fa fa-cubes"></i> Stock order items
          <button type="button" class="btn btn-link float-right">
            <i class="fa fa-filter fa-2x"></i>
          </button>
        </div>
        <div class="card-body">
          <tabset>
            <tab heading="Not Approved ({{totalNotApprovedLineItems}})">
              <table class="table table-striped table-hover">
                <thead>
                <tr>
                  <th>Name</th>
                  <th>SKU</th>
                  <th width="140">Order Quantity</th>
                  <th>Store Inventory</th>
                  <th>Approve</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let lineItem of notApprovedLineItems">
                  <ng-container *ngIf="lineItem.productModel">
                    <td>
                      {{lineItem.productModel.name}}
                      <br/>
                      <small>({{lineItem.productModel.sizeId}} : {{lineItem.productModel.colorId}} :
                        {{lineItem.productModel.styleId}} : {{lineItem.productModel.configurationId}})
                      </small>
                    </td>
                    <td>{{lineItem.productModel.api_id}}</td>
                    <td>
                      <i class="fa fa-minus-circle quantity-icon text-danger"
                         (click)="lineItem.orderQuantity = lineItem.orderQuantity - 1"></i>
                      <input type="number" class="input-order-quantity" [(ngModel)]="lineItem.orderQuantity"/>
                      <i class="fa fa-plus-circle quantity-icon text-success"
                         (click)="lineItem.orderQuantity = lineItem.orderQuantity + 1"></i>
                    </td>
                    <td>{{lineItem.storeInventory}}</td>
                    <td>
                      <button class="btn btn-danger" type="submit"
                              (click)="updateLineItems(lineItem, {approved: true, orderQuantity: lineItem.orderQuantity})">
                        <i class="fa fa-save"></i> Approve
                      </button>
                    </td>
                  </ng-container>
                </tr>
                </tbody>
              </table>
              <ul class="pagination">
                <li class="page-item" *ngFor="let lineItem of notApprovedLineItems | paginate: {itemsPerPage: lineItemsLimitPerPage,
                                                                 currentPage: currentPageNotApproved,
                                                                 totalItems: totalNotApprovedLineItems,
                                                                 id: 'notApproved'}">
                </li>
              </ul>
              <pagination-controls
                (pageChange)="getNotApprovedStockOrderLineItems(lineItemsLimitPerPage, currentPageNotApproved*lineItemsLimitPerPage); currentPage=$event"></pagination-controls>
            </tab>

            <tab heading="Approved ({{totalApprovedLineItems}})">
              <table class="table table-striped table-hover">
                <thead>
                <tr>
                  <th>Name</th>
                  <th>SKU</th>
                  <th>Order Quantity</th>
                  <th>Fulfilled Quantity</th>
                  <th>Approve</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let lineItem of approvedLineItems">
                  <ng-container *ngIf="lineItem.productModel">
                    <td>
                      {{lineItem.productModel.name}}
                      <br/>
                      <small>({{lineItem.productModel.sizeId}} : {{lineItem.productModel.colorId}} :
                        {{lineItem.productModel.styleId}} : {{lineItem.productModel.configurationId}})
                      </small>
                    </td>
                    <td>{{lineItem.productModel.api_id}}</td>
                    <td>
                      {{lineItem.orderQuantity}}
                    </td>
                    <td>{{lineItem.fulfilledQuantity}}</td>
                    <td>
                      <button class="btn btn-danger" type="submit"
                              (click)="updateLineItems(lineItem, {approved: false})">
                        <i class="fa fa-save"></i> Remove
                      </button>
                    </td>
                  </ng-container>
                </tr>
                </tbody>
              </table>
              <ul class="pagination" *ngIf="approvedLineItems">
                <li class="page-item" *ngFor="let lineItem of approvedLineItems | paginate: {itemsPerPage: lineItemsLimitPerPage,
                                                                 currentPage: currentPageApproved,
                                                                 totalItems: totalApprovedLineItems,
                                                                 id: 'approved'}">
                </li>
              </ul>
              <pagination-controls
                (pageChange)="getApprovedStockOrderLineItems(lineItemsLimitPerPage, currentPageApproved*lineItemsLimitPerPage); currentPage=$event"></pagination-controls>
            </tab>
          </tabset>
        </div>
      </div>
    </div>
    <!--/.col-->
  </div>
</div>
